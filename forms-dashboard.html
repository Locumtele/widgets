<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forms Dashboard - LocumTele</title>
    <link rel="stylesheet" href="https://locumtele.github.io/widgets/docs/brand/brand.css">
    <link rel="stylesheet" href="https://locumtele.github.io/widgets/docs/brand/dashboard-framework.css">
    <link rel="stylesheet" href="https://locumtele.github.io/widgets/docs/brand/sites-consolidated.css">
    <style>
        /* Additional custom styles for forms dashboard */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .data-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid var(--lt-blue);
        }

        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .data-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .data-card-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
            color: var(--lt-blue);
        }

        .data-card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--lt-gray-800);
            margin: 0;
        }

        .data-card-content {
            color: var(--lt-gray-600);
            line-height: 1.6;
        }

        .data-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .data-stat {
            background: linear-gradient(135deg, var(--lt-blue) 0%, var(--lt-green) 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .data-stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .data-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .data-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 2rem 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--lt-blue) 0%, var(--lt-blue-dark) 100%);
            color: white;
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .data-table tbody tr {
            border-bottom: 1px solid var(--lt-gray-200);
            transition: all 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: var(--lt-gray-50);
        }

        .data-table td {
            padding: 1rem;
            vertical-align: top;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .category-toggle.active {
            background: var(--lt-blue) !important;
            color: white !important;
        }

        .dashboard-btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-draft {
            background: #fff3cd;
            color: #856404;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-view {
            background: var(--lt-blue);
            color: white;
        }

        .btn-edit {
            background: var(--lt-green);
            color: white;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--lt-gray-300);
            border-radius: 50%;
            border-top-color: var(--lt-blue);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--lt-gray-500);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body class="lt-branded">
    <div class="dashboard-layout">
        <!-- Sidebar Navigation -->
        <nav class="dashboard-sidebar" id="sidebar">
            <div class="logo">
                <img src="https://locumtele.github.io/widgets/docs/brand/locumteleLogo.png" alt="LocumTele Logo">
            </div>
            <ul class="dashboard-nav">
                <li class="dashboard-nav-item">
                    <a href="#" class="dashboard-nav-link" onclick="loadPage('dashboard', this)">
                        üìä Dashboard
                    </a>
                </li>
                <li class="dashboard-nav-item">
                    <a href="#" class="dashboard-nav-link active" onclick="loadPage('forms', this)">
                        üìù Forms
                    </a>
                </li>
                <li class="dashboard-nav-item">
                    <a href="#" class="dashboard-nav-link" onclick="loadPage('analytics', this)">
                        üìà Analytics
                    </a>
                </li>
                <li class="dashboard-nav-item">
                    <a href="#" class="dashboard-nav-link" onclick="loadPage('control', this)">
                        üéõÔ∏è Control Panel
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Top Navigation Bar -->
        <div class="dashboard-header">
            <h1>üìù Forms</h1>
            <p class="page-description">Form Management & Question Logic</p>
        </div>

        <!-- Main Content Area -->
        <div class="dashboard-content">
            <div class="dashboard-container">
                <!-- Dynamic Page Content -->
                <div id="page-content" class="dashboard-page-content">
                    <!-- Data page content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="dashboard-mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>

    <script>
        // Dashboard configuration
        const DASHBOARD_CONFIG = {
            title: "Forms Dashboard",
            headerTitle: "üìù Forms",
            headerDescription: "Form Management & Question Logic",
            pages: {
                'dashboard': { 
                    title: 'üìä Dashboard', 
                    description: 'Main Dashboard & Analytics',
                    icon: 'üìä'
                },
                'forms': { 
                    title: 'üìù Forms', 
                    description: 'Form Management & Question Logic',
                    icon: 'üìù'
                },
                'analytics': { 
                    title: 'üìà Analytics', 
                    description: 'Performance & Usage Analytics',
                    icon: 'üìà'
                },
                'control': { 
                    title: 'üéõÔ∏è Control Panel', 
                    description: 'Automation Controls & Status Management',
                    icon: 'üéõÔ∏è'
                }
            }
        };

        // Load actual form data from JSON files
        let FORMS_DATA = {
            forms: [],
            submissions: []
        };

        // Load forms directly from GitHub Pages surveys directory
        async function loadFormsData() {
            try {
                const forms = [];
                
                // Define the categories to scan
                const categories = [
                    { name: 'Weightloss', path: 'weightloss' },
                    { name: 'Hormone', path: 'hormone' },
                    { name: 'AntiAging', path: 'antiaging' }
                ];

                // Scan each category for JSON files
                for (const category of categories) {
                    try {
                        // Try to load known forms for each category
                        const knownForms = {
                            'weightloss': ['GLP1-screener.json'],
                            'hormone': ['Sermorelin-screener.json'],
                            'antiaging': ['NAD-screener.json']
                        };

                        for (const formFile of knownForms[category.path] || []) {
                            try {
                                const formUrl = `https://locumtele.github.io/widgets/surveys/${category.path}/${formFile}`;
                                const response = await fetch(formUrl);
                                
                                if (response.ok) {
                                    const formData = await response.json();
                                    const formSpecificQuestions = formData.questions || [];
                                    
                                    // Extract form name from filename
                                    const formName = formFile.replace('-screener.json', '').replace('-screener', '');
                                    
                                    // Check if HTML file exists
                                    const htmlUrl = `https://locumtele.github.io/widgets/surveys/${category.path}/${formName}-screener-live.html`;
                                    let htmlStatus = 'missing';
                                    try {
                                        const htmlResponse = await fetch(htmlUrl, { method: 'HEAD' });
                                        htmlStatus = htmlResponse.ok ? 'exists' : 'missing';
                                    } catch (e) {
                                        htmlStatus = 'missing';
                                    }
                                    
                                    const formObj = {
                                        id: formData.id || formName.toLowerCase(),
                                        name: formData.name || formName,
                                        category: formData.property_category || category.name,
                                        status: formData.property_form_status === 'PUBLISHED' ? 'active' : 'draft',
                                        formType: formData.property_form_type || 'screener',
                                        consultType: formData.property_consult_type || 'async',
                                        questions: formSpecificQuestions,
                                        questionCount: formSpecificQuestions.length,
                                        url: formData.url,
                                        lastUpdated: formData.property_last_updated,
                                        rawData: formData,
                                        jsonUrl: formUrl,
                                        htmlPath: `surveys/${category.path}/${formName}-screener-live.html`,
                                        htmlStatus: htmlStatus,
                                        embedStatus: htmlStatus === 'exists' ? 'ready' : 'pending'
                                    };
                                    forms.push(formObj);
                                }
                            } catch (formError) {
                                console.warn(`Could not load ${formFile}:`, formError);
                            }
                        }
                    } catch (categoryError) {
                        console.warn(`Could not load category ${category.name}:`, categoryError);
                    }
                }

                // Add mock submissions for demonstration
                const mockSubmissions = [
                    {
                        id: 'sub_001',
                        formId: '27582abf-7eae-805a-9e68-f2347298b0a7',
                        formName: 'GLP1',
                        submittedAt: '2025-01-15T10:30:00Z',
                        patientName: 'John Doe',
                        patientEmail: 'john.doe@email.com',
                        status: 'completed',
                        data: {
                            bmi: 28.5,
                            age: 35,
                            weight: 180,
                            height: 72
                        }
                    },
                    {
                        id: 'sub_002',
                        formId: '27582abf-7eae-805a-9e68-f2347298b0a7',
                        formName: 'GLP1',
                        submittedAt: '2025-01-15T09:15:00Z',
                        patientName: 'Jane Smith',
                        patientEmail: 'jane.smith@email.com',
                        status: 'completed',
                        data: {
                            age: 42,
                            symptoms: ['fatigue', 'mood_swings'],
                            previousTreatment: false
                        }
                    }
                ];

                FORMS_DATA = {
                    forms: forms,
                    submissions: mockSubmissions
                };

                return FORMS_DATA;
            } catch (error) {
                console.error('Error loading forms data:', error);
                return { forms: [], submissions: [] };
            }
        }

        // Load page content dynamically
        async function loadPage(pageId, clickedElement = null) {
            try {
                console.log('Loading page:', pageId);
                
                // Show loading state
                const pageContent = document.getElementById('page-content');
                pageContent.innerHTML = '<div class="dashboard-loading"><div class="dashboard-spinner"></div><p>Loading...</p></div>';
                
                // Load forms data if not already loaded
                if (FORMS_DATA.forms.length === 0) {
                    await loadFormsData();
                }
                
                // Update active menu item
                const menuLinks = document.querySelectorAll('.dashboard-nav-link');
                menuLinks.forEach(link => {
                    link.classList.remove('active');
                });
                
                if (clickedElement) {
                    clickedElement.classList.add('active');
                }
                
                // Update header based on page
                const header = document.querySelector('.dashboard-header h1');
                const description = document.querySelector('.dashboard-header .page-description');
                
                if (DASHBOARD_CONFIG.pages[pageId]) {
                    header.innerHTML = DASHBOARD_CONFIG.pages[pageId].title;
                    description.textContent = DASHBOARD_CONFIG.pages[pageId].description;
                }
                
                // Load page content based on pageId
                let content = '';
                switch(pageId) {
                    case 'dashboard':
                        content = loadDashboardPage();
                        break;
                    case 'forms':
                        content = loadFormsPage();
                        break;
                    case 'analytics':
                        content = loadAnalyticsPage();
                        break;
                    case 'control':
                        content = loadControlPage();
                        break;
                    default:
                        content = loadFormsPage();
                }
                
                pageContent.innerHTML = content;
                
                // Trigger animations
                const animatedElements = pageContent.querySelectorAll('.dashboard-animate');
                animatedElements.forEach((element, index) => {
                    element.style.opacity = '1';
                    element.style.animation = 'dashboard-fadeInUp 0.6s ease-out forwards';
                    element.style.animationDelay = `${index * 0.1}s`;
                });
                
            } catch (error) {
                console.error('Error loading page:', error);
                pageContent.innerHTML = `
                    <div class="dashboard-card" style="text-align: center; padding: 2rem;">
                        <h2>Error Loading Page</h2>
                        <p>Sorry, there was an error loading the ${pageId} page. Please try again.</p>
                        <button class="dashboard-btn dashboard-btn-primary" onclick="loadPage('data')">Return to Data</button>
                    </div>
                `;
            }
        }

        // Load Forms page content (moved from Data)
        function loadFormsPage() {
            const totalSubmissions = FORMS_DATA.submissions.length;
            const activeForms = FORMS_DATA.forms.filter(f => f.status === 'active').length;
            const totalForms = FORMS_DATA.forms.length;
            const avgCompletionRate = FORMS_DATA.forms.length > 0 ? 
                FORMS_DATA.forms.reduce((sum, f) => sum + (f.questionCount || 0), 0) / totalForms : 0;

            return `
                <div class="dashboard-animate">
                    <!-- Stats Overview -->
                        <div class="data-stats">
                            <div class="data-stat">
                                <div class="data-stat-value">${totalSubmissions.toLocaleString()}</div>
                                <div class="data-stat-label">Total Submissions</div>
                            </div>
                            <div class="data-stat">
                                <div class="data-stat-value">${activeForms}</div>
                                <div class="data-stat-label">Active Forms</div>
                            </div>
                            <div class="data-stat">
                                <div class="data-stat-value">${avgCompletionRate.toFixed(0)}</div>
                                <div class="data-stat-label">Avg Questions per Form</div>
                            </div>
                            <div class="data-stat">
                                <div class="data-stat-value">${totalForms}</div>
                                <div class="data-stat-label">Total Forms</div>
                            </div>
                        </div>

                    <!-- Forms Overview -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h2 class="dashboard-card-title">üìù Forms Overview</h2>
                        </div>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Form Name</th>
                                        <th>Category</th>
                                        <th>Status</th>
                                        <th>Questions</th>
                                        <th>Form Type</th>
                                        <th>Consult Type</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${FORMS_DATA.forms.map(form => `
                                        <tr>
                                            <td>
                                                <div style="font-weight: 600; color: var(--lt-gray-800);">${form.name}</div>
                                                <div style="font-size: 0.8rem; color: var(--lt-gray-500);">${form.questionCount} form-specific questions</div>
                                            </td>
                                            <td>
                                                <span class="status-badge" style="background: var(--lt-blue-light); color: var(--lt-blue-dark);">
                                                    ${form.category}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${form.status === 'active' ? 'status-active' : form.status === 'draft' ? 'status-draft' : 'status-inactive'}">
                                                    ${form.status}
                                                </span>
                                            </td>
                                            <td style="font-weight: 600; color: var(--lt-gray-800);">
                                                ${form.questionCount}
                                            </td>
                                            <td style="color: var(--lt-gray-600);">
                                                ${form.formType || 'N/A'}
                                            </td>
                                            <td style="color: var(--lt-gray-600);">
                                                ${form.consultType || 'N/A'}
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="action-btn btn-view" onclick="viewQuestions('${form.id}')">
                                                        üìã View Questions
                                                    </button>
                                                    <button class="action-btn btn-edit" onclick="viewSurvey('${form.id}')">
                                                        üëÅÔ∏è View Survey
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recent Submissions -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h2 class="dashboard-card-title">üìã Recent Submissions</h2>
                        </div>
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Patient</th>
                                        <th>Form</th>
                                        <th>Submitted</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${FORMS_DATA.submissions.map(submission => `
                                        <tr>
                                            <td>
                                                <div style="font-weight: 600; color: var(--lt-gray-800);">${submission.patientName}</div>
                                                <div style="font-size: 0.8rem; color: var(--lt-gray-500);">${submission.patientEmail}</div>
                                            </td>
                                            <td style="font-weight: 500; color: var(--lt-gray-700);">
                                                ${submission.formName}
                                            </td>
                                            <td style="color: var(--lt-gray-600);">
                                                ${new Date(submission.submittedAt).toLocaleString()}
                                            </td>
                                            <td>
                                                <span class="status-badge status-active">
                                                    ${submission.status}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="action-btn btn-view" onclick="viewSubmission('${submission.id}')">
                                                        üëÅÔ∏è View
                                                    </button>
                                                    <button class="action-btn btn-edit" onclick="downloadSubmission('${submission.id}')">
                                                        üì• Download
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="data-grid">
                        <div class="data-card">
                            <div class="data-card-header">
                                <span class="data-card-icon">üìä</span>
                                <h3 class="data-card-title">Export Data</h3>
                            </div>
                            <div class="data-card-content">
                                <p>Export form submissions and analytics data in various formats (CSV, JSON, Excel).</p>
                                <button class="dashboard-btn dashboard-btn-primary" onclick="exportData()">
                                    üì§ Export All Data
                                </button>
                            </div>
                        </div>

                        <div class="data-card">
                            <div class="data-card-header">
                                <span class="data-card-icon">üîç</span>
                                <h3 class="data-card-title">Search & Filter</h3>
                            </div>
                            <div class="data-card-content">
                                <p>Search through submissions and filter by date, form, or patient information.</p>
                                <button class="dashboard-btn dashboard-btn-secondary" onclick="openSearch()">
                                    üîç Open Search
                                </button>
                            </div>
                        </div>

                        <div class="data-card">
                            <div class="data-card-header">
                                <span class="data-card-icon">üìà</span>
                                <h3 class="data-card-title">Analytics</h3>
                            </div>
                            <div class="data-card-content">
                                <p>View detailed analytics and performance metrics for your forms.</p>
                                <button class="dashboard-btn dashboard-btn-outline" onclick="loadPage('analytics')">
                                    üìà View Analytics
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load Dashboard page content (embed code library)
        function loadDashboardPage() {
            // Get forms that have HTML files ready
            const readyForms = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                return form.name === 'GLP1' && categoryDir === 'weightloss';
            });

            // Get unique categories
            const categories = [...new Set(readyForms.map(form => form.category))];

            return `
                <div class="dashboard-animate">
                    <!-- Embed Code Library -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h2 class="dashboard-card-title">üì¶ Embed Code Library</h2>
                            <p style="color: var(--lt-gray-600); margin: 0; font-size: 0.9rem;">
                                Ready-to-use embed codes for client deployment
                            </p>
                        </div>
                        <div class="dashboard-card-content">
                            <!-- Search and Category Toggle -->
                            <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <input type="text" id="embedSearch" placeholder="Search surveys..." 
                                           style="width: 100%; padding: 0.75rem; border: 1px solid var(--lt-gray-300); border-radius: 6px; font-size: 0.9rem;"
                                           onkeyup="filterEmbedLibrary()">
                                </div>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button class="dashboard-btn dashboard-btn-ghost category-toggle active" 
                                            data-category="" onclick="toggleCategory('', this)">
                                        All (${readyForms.length})
                                    </button>
                                    ${categories.map(category => {
                                        const count = readyForms.filter(f => f.category === category).length;
                                        return `<button class="dashboard-btn dashboard-btn-ghost category-toggle" 
                                                      data-category="${category}" onclick="toggleCategory('${category}', this)">
                                                    ${category} (${count})
                                                </button>`;
                                    }).join('')}
                                </div>
                            </div>

                            <!-- Compact Forms Table -->
                            <div class="data-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Survey</th>
                                            <th>Category</th>
                                            <th>Questions</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="embedTableBody">
                                        ${readyForms.map(form => `
                                            <tr class="embed-row" data-category="${form.category}" data-name="${form.name.toLowerCase()}">
                                                <td>
                                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                        <span style="font-size: 1.2rem;">üì¶</span>
                                                        <div>
                                                            <div style="font-weight: 600; color: var(--lt-gray-800);">${form.name}</div>
                                                            <div style="font-size: 0.8rem; color: var(--lt-gray-500);">Medical Screening</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="status-badge" style="background: var(--lt-blue-light); color: var(--lt-blue-dark);">
                                                        ${form.category}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span style="color: var(--lt-gray-600); font-size: 0.9rem;">
                                                        ${form.questionCount} questions
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="status-badge status-active">
                                                        ‚úÖ Ready
                                                    </span>
                                                </td>
                                                <td>
                                                    <div style="display: flex; gap: 0.5rem;">
                                                        <button class="dashboard-btn dashboard-btn-primary dashboard-btn-sm" 
                                                                onclick="copyEmbedCode('${form.id}', '${form.name}')">
                                                            üìã Copy
                                                        </button>
                                                        <button class="dashboard-btn dashboard-btn-outline dashboard-btn-sm" 
                                                                onclick="previewEmbed('${form.id}', '${form.name}')">
                                                            üëÅÔ∏è
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>

                            ${readyForms.length === 0 ? `
                                <div style="text-align: center; padding: 3rem; color: var(--lt-gray-500);">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">üì¶</div>
                                    <h3>No Embed Codes Available</h3>
                                    <p>Generate HTML files first in the Control Panel to create embed codes.</p>
                                    <button class="dashboard-btn dashboard-btn-primary" onclick="loadPage('control')" style="margin-top: 1rem;">
                                        üéõÔ∏è Go to Control Panel
                                    </button>
                                </div>
                            ` : ''}

                            <!-- Quick Actions Row -->
                            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--lt-gray-200); flex-wrap: wrap;">
                                <button class="dashboard-btn dashboard-btn-secondary" onclick="copyAllEmbedCodes()">
                                    üìã Copy All Codes
                                </button>
                                <button class="dashboard-btn dashboard-btn-outline" onclick="generateDeploymentReport()">
                                    üìä Deployment Report
                                </button>
                                <button class="dashboard-btn dashboard-btn-ghost" onclick="loadPage('forms')">
                                    üìù Manage Forms
                                </button>
                                <button class="dashboard-btn dashboard-btn-ghost" onclick="loadPage('control')">
                                    üéõÔ∏è Control Panel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load Analytics page content
        function loadAnalyticsPage() {
            return `
                <div class="dashboard-animate">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h2 class="dashboard-card-title">üìà Analytics Dashboard</h2>
                        </div>
                        <div class="empty-state">
                            <div class="empty-state-icon">üìà</div>
                            <h3>Analytics Dashboard</h3>
                            <p>This page will contain detailed analytics and performance metrics.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Load Control Panel page content
        function loadControlPage() {
            // Use status from manifest data (already loaded in loadFormsData)
            const formsWithStatus = FORMS_DATA.forms.map(form => ({
                ...form,
                hasHTML: form.htmlStatus === 'exists',
                htmlStatus: form.htmlStatus || 'missing',
                embedStatus: form.embedStatus || 'pending'
            }));

            return `
                <div class="dashboard-animate">
                    <!-- Survey Status Overview -->
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h2 class="dashboard-card-title">üéõÔ∏è Control Panel</h2>
                            <p style="color: var(--lt-gray-600); margin: 0; font-size: 0.9rem;">
                                Safe automation controls and status management
                            </p>
                        </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="dashboard-btn dashboard-btn-primary" onclick="generateAllHTML()">
                                    üîß Generate All HTML
                                </button>
                                <button class="dashboard-btn dashboard-btn-outline" onclick="refreshAllHTML()">
                                    üîÑ Refresh All HTML
                                </button>
                                <button class="dashboard-btn dashboard-btn-secondary" onclick="refreshStatus()">
                                    üîÑ Refresh Status
                                </button>
                            </div>
                        </div>
                        
                        <div class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Survey</th>
                                        <th>Category</th>
                                        <th>JSON Status</th>
                                        <th>HTML File</th>
                                        <th>Embed Code</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${formsWithStatus.map(form => `
                                        <tr>
                                            <td>
                                                <div style="font-weight: 600; color: var(--lt-gray-800);">${form.name}</div>
                                                <div style="font-size: 0.8rem; color: var(--lt-gray-500);">${form.questionCount} questions</div>
                                            </td>
                                            <td>
                                                <span class="status-badge" style="background: var(--lt-blue-light); color: var(--lt-blue-dark);">
                                                    ${form.category}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge status-active">
                                                    ‚úÖ Available
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${form.htmlStatus === 'exists' ? 'status-active' : 'status-draft'}">
                                                    ${form.htmlStatus === 'exists' ? '‚úÖ Exists' : '‚ùå Missing'}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${form.embedStatus === 'ready' ? 'status-active' : 'status-draft'}">
                                                    ${form.embedStatus === 'ready' ? '‚úÖ Ready' : '‚è≥ Pending'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    ${form.htmlStatus === 'exists' ? 
                                                        `<button class="action-btn btn-edit" onclick="refreshHTML('${form.category}', '${form.name}')" style="background: var(--lt-green); color: white;">
                                                            üîÑ Refresh HTML
                                                        </button>` :
                                                        `<button class="action-btn btn-edit" onclick="generateHTML('${form.category}', '${form.name}')" style="background: var(--lt-blue); color: white;">
                                                            üîß Create HTML
                                                        </button>`
                                                    }
                                                    ${form.embedStatus === 'ready' ? 
                                                        `<button class="action-btn btn-edit" onclick="refreshEmbed('${form.category}', '${form.name}')" style="background: var(--lt-green); color: white;">
                                                            üîÑ Refresh Embed
                                                        </button>` :
                                                        `<button class="action-btn" onclick="alert('Create HTML file first')" style="background: var(--lt-gray-300); color: var(--lt-gray-600); cursor: not-allowed; opacity: 0.6;">
                                                            üì¶ Generate Embed
                                                        </button>`
                                                    }
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Automation Controls -->
                    <div class="data-grid">
                        <div class="data-card">
                            <div class="data-card-header">
                                <span class="data-card-icon">üîß</span>
                                <h3 class="data-card-title">HTML Generation</h3>
                            </div>
                            <div class="data-card-content">
                                <p>Generate HTML files for surveys from JSON data using the universal form generator.</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                    <button class="dashboard-btn dashboard-btn-primary" onclick="generateAllHTML()">
                                        üîß Generate All
                                    </button>
                                    <button class="dashboard-btn dashboard-btn-outline" onclick="showHTMLStatus()">
                                        üìä Status Report
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="data-card">
                            <div class="data-card-header">
                                <span class="data-card-icon">üì¶</span>
                                <h3 class="data-card-title">Embed Code Generation</h3>
                            </div>
                            <div class="data-card-content">
                                <p>Generate embed codes for client deployment once HTML files are ready.</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                    <button class="dashboard-btn dashboard-btn-secondary" onclick="generateAllEmbeds()">
                                        üì¶ Generate All
                                    </button>
                                    <button class="dashboard-btn dashboard-btn-outline" onclick="showEmbedStatus()">
                                        üìä Status Report
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="data-card">
                            <div class="data-card-header">
                                <span class="data-card-icon">üîÑ</span>
                                <h3 class="data-card-title">System Refresh</h3>
                            </div>
                            <div class="data-card-content">
                                <p>Refresh all data and status information from the surveys directory.</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                    <button class="dashboard-btn dashboard-btn-ghost" onclick="refreshStatus()">
                                        üîÑ Refresh All
                                    </button>
                                    <button class="dashboard-btn dashboard-btn-outline" onclick="showSystemStatus()">
                                        üìä System Status
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Action functions
        function viewQuestions(formId) {
            const form = FORMS_DATA.forms.find(f => f.id === formId);
            if (!form) {
                alert('Form not found');
                return;
            }

            // Create modal to show form details with categorized options
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                padding: 2rem;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 12px;
                padding: 2rem;
                max-width: 900px;
                width: 100%;
                max-height: 80%;
                overflow-y: auto;
                box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            `;

            const questionsList = form.questions.map((q, index) => {
                // Categorize options
                const safeAnswers = q.property_safe_answers || [];
                const flagAnswers = q.property_flag_answers || [];
                const disqualifyAnswers = q.property_disqualify_answers || [];
                
                const renderOptions = (options, color, label) => {
                    if (!options || options.length === 0) return '';
                    return `
                        <div style="margin-bottom: 0.5rem;">
                            <div style="font-size: 0.8rem; font-weight: 600; color: ${color}; margin-bottom: 0.25rem;">
                                ${label}:
                            </div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                ${options.map(option => `
                                    <span style="background: ${color}20; color: ${color}; padding: 0.2rem 0.5rem; border-radius: 12px; font-size: 0.75rem; border: 1px solid ${color}40;">
                                        ${option}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    `;
                };

                return `
                    <div style="border: 1px solid var(--lt-gray-200); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; background: #fafafa;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div style="font-weight: 600; color: var(--lt-gray-800); font-size: 1.1rem; flex: 1;">
                                ${index + 1}. ${q.property_question_text}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--lt-gray-500); margin-left: 1rem;">
                                ${q.property_question_type}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div style="padding: 0.5rem; background: white; border-radius: 6px; border: 1px solid var(--lt-gray-200);">
                                <div style="font-size: 0.8rem; font-weight: 600; color: var(--lt-gray-600); margin-bottom: 0.25rem;">Required</div>
                                <div style="color: var(--lt-gray-800);">${q.property_required ? 'Yes' : 'No'}</div>
                            </div>
                            <div style="padding: 0.5rem; background: white; border-radius: 6px; border: 1px solid var(--lt-gray-200);">
                                <div style="font-size: 0.8rem; font-weight: 600; color: var(--lt-gray-600); margin-bottom: 0.25rem;">Section</div>
                                <div style="color: var(--lt-gray-800);">${q.property_section || 'N/A'}</div>
                            </div>
                            <div style="padding: 0.5rem; background: white; border-radius: 6px; border: 1px solid var(--lt-gray-200);">
                                <div style="font-size: 0.8rem; font-weight: 600; color: var(--lt-gray-600); margin-bottom: 0.25rem;">Show Condition</div>
                                <div style="color: var(--lt-gray-800);">${q.property_show_condition || 'Always'}</div>
                            </div>
                        </div>

                        <div style="background: white; padding: 1rem; border-radius: 6px; border: 1px solid var(--lt-gray-200);">
                            <div style="font-size: 0.9rem; font-weight: 600; color: var(--lt-gray-700); margin-bottom: 0.75rem;">Answer Logic:</div>
                            ${renderOptions(safeAnswers, '#28a745', '‚úÖ Safe Answers')}
                            ${renderOptions(flagAnswers, '#ffc107', '‚ö†Ô∏è Flag Answers')}
                            ${renderOptions(disqualifyAnswers, '#dc3545', '‚ùå Disqualify Answers')}
                            
                            ${q.property_disqualify_message ? `
                                <div style="margin-top: 0.75rem; padding: 0.75rem; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px;">
                                    <div style="font-size: 0.8rem; font-weight: 600; color: #721c24; margin-bottom: 0.25rem;">Disqualify Message:</div>
                                    <div style="font-size: 0.85rem; color: #721c24;">${q.property_disqualify_message}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="margin: 0; color: var(--lt-blue);">üìã ${form.name} - Question Logic</h3>
                    <button onclick="closeModal()" style="background: #dc3545; color: white; border: none; padding: 0.5rem; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">‚úï</button>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div style="padding: 1rem; background: var(--lt-gray-50); border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--lt-gray-800);">Category</div>
                            <div style="color: var(--lt-gray-600);">${form.category}</div>
                        </div>
                        <div style="padding: 1rem; background: var(--lt-gray-50); border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--lt-gray-800);">Status</div>
                            <div style="color: var(--lt-gray-600);">${form.status}</div>
                        </div>
                        <div style="padding: 1rem; background: var(--lt-gray-50); border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--lt-gray-800);">Questions</div>
                            <div style="color: var(--lt-gray-600);">${form.questionCount}</div>
                        </div>
                        <div style="padding: 1rem; background: var(--lt-gray-50); border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--lt-gray-800);">Form Type</div>
                            <div style="color: var(--lt-gray-600);">${form.formType}</div>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 style="color: var(--lt-gray-800); margin-bottom: 1rem;">Form-Specific Questions with Logic (${form.questionCount})</h4>
                    <div style="max-height: 500px; overflow-y: auto;">
                        ${questionsList}
                    </div>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Store modal reference for cleanup
            window.currentModal = modal;

            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        function viewSurvey(formId) {
            const form = FORMS_DATA.forms.find(f => f.id === formId);
            if (!form) {
                alert('Form not found');
                return;
            }

            // Determine the HTML file path based on form data
            const categoryDir = form.category.toLowerCase();
            const htmlFileName = `${form.name}-screener-live.html`;
            const surveyPath = `surveys/${categoryDir}/${htmlFileName}`;

            // Create modal to show survey preview
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 2rem;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                width: 100%;
                max-width: 1200px;
                height: 90%;
                background: white;
                border-radius: 12px;
                overflow: hidden;
                position: relative;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            `;

            // Create close button
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '‚úï';
            closeBtn.style.cssText = `
                position: absolute;
                top: 15px;
                right: 20px;
                background: #dc3545;
                color: white;
                border: none;
                width: 35px;
                height: 35px;
                border-radius: 50%;
                cursor: pointer;
                font-size: 16px;
                font-weight: bold;
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
            `;

            // Create iframe
            const iframe = document.createElement('iframe');
            iframe.src = surveyPath;
            iframe.style.cssText = `
                width: 100%;
                height: 100%;
                border: none;
            `;

            // Add header
            const header = document.createElement('div');
            header.style.cssText = `
                background: var(--lt-blue);
                color: white;
                padding: 1rem 2rem;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            `;
            header.innerHTML = `üëÅÔ∏è ${form.name} Survey Preview`;

            // Assemble modal
            modalContent.appendChild(header);
            modalContent.appendChild(iframe);
            modalContent.appendChild(closeBtn);
            modal.appendChild(modalContent);

            // Close handlers
            closeBtn.onclick = () => closeModal();
            modal.onclick = (e) => {
                if (e.target === modal) closeModal();
            };

            // Add to page
            document.body.appendChild(modal);

            // Store modal reference for cleanup
            window.currentModal = modal;
        }

        function closeModal() {
            if (window.currentModal) {
                document.body.removeChild(window.currentModal);
                window.currentModal = null;
            }
        }


        function viewSubmission(submissionId) {
            alert(`Viewing submission: ${submissionId}`);
        }

        function downloadSubmission(submissionId) {
            alert(`Downloading submission: ${submissionId}`);
        }

        // Control Panel Action Functions
        function generateHTML(category, formName) {
            alert(`üîß Generating HTML for ${formName} in ${category} category...\n\nThis will call the Python form generator API to create the HTML file.`);
        }

        function refreshHTML(category, formName) {
            alert(`üîÑ Refreshing HTML for ${formName} in ${category} category...\n\nThis will regenerate the HTML file with the latest form data and logic.`);
        }

        function viewHTMLFile(htmlPath) {
            window.open(htmlPath, '_blank');
        }

        function generateEmbed(category, formName) {
            alert(`üì¶ Generating embed code for ${formName}...\n\nThis will create the embed code for client deployment.`);
        }

        function refreshEmbed(category, formName) {
            alert(`üîÑ Refreshing embed code for ${formName}...\n\nThis will regenerate the embed code with the latest HTML file.`);
        }

        function generateAllHTML() {
            const pendingForms = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                const hasHTML = form.name === 'GLP1' && categoryDir === 'weightloss';
                return !hasHTML;
            });

            if (pendingForms.length === 0) {
                alert('‚úÖ All HTML files are already generated!');
                return;
            }

            alert(`üîß Generating HTML for ${pendingForms.length} pending forms:\n\n${pendingForms.map(f => `‚Ä¢ ${f.name} (${f.category})`).join('\n')}\n\nThis will call the Python form generator API for each form.`);
        }

        function refreshAllHTML() {
            const existingForms = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                return form.name === 'GLP1' && categoryDir === 'weightloss';
            });

            if (existingForms.length === 0) {
                alert('No HTML files found to refresh! Generate HTML files first.');
                return;
            }

            alert(`üîÑ Refreshing HTML for ${existingForms.length} forms:\n\n${existingForms.map(f => `‚Ä¢ ${f.name} (${f.category})`).join('\n')}\n\nThis will regenerate HTML files with the latest form data and logic.`);
        }

        function generateAllEmbeds() {
            const readyForms = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                const hasHTML = form.name === 'GLP1' && categoryDir === 'weightloss';
                return hasHTML;
            });

            if (readyForms.length === 0) {
                alert('‚ùå No forms are ready for embed code generation. Generate HTML files first.');
                return;
            }

            alert(`üì¶ Generating embed codes for ${readyForms.length} ready forms:\n\n${readyForms.map(f => `‚Ä¢ ${f.name} (${f.category})`).join('\n')}\n\nThis will create embed codes for client deployment.`);
        }

        function refreshStatus() {
            alert('üîÑ Refreshing status...\n\nThis will reload all form data and check HTML file status.');
            // Reload the page to refresh data
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        function showHTMLStatus() {
            const status = FORMS_DATA.forms.map(form => {
                const categoryDir = form.category.toLowerCase();
                const hasHTML = form.name === 'GLP1' && categoryDir === 'weightloss';
                return `${form.name}: ${hasHTML ? '‚úÖ HTML exists' : '‚ùå HTML missing'}`;
            }).join('\n');

            alert(`üìä HTML Status Report:\n\n${status}`);
        }

        function showEmbedStatus() {
            const status = FORMS_DATA.forms.map(form => {
                const categoryDir = form.category.toLowerCase();
                const hasHTML = form.name === 'GLP1' && categoryDir === 'weightloss';
                return `${form.name}: ${hasHTML ? '‚úÖ Ready for embed' : '‚è≥ Pending HTML'}`;
            }).join('\n');

            alert(`üìä Embed Status Report:\n\n${status}`);
        }

        function showSystemStatus() {
            const totalForms = FORMS_DATA.forms.length;
            const htmlReady = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                return form.name === 'GLP1' && categoryDir === 'weightloss';
            }).length;
            const embedReady = htmlReady;

            alert(`üìä System Status Report:\n\n‚Ä¢ Total Forms: ${totalForms}\n‚Ä¢ HTML Ready: ${htmlReady}\n‚Ä¢ Embed Ready: ${embedReady}\n‚Ä¢ Pending: ${totalForms - htmlReady}\n\nSystem is ${htmlReady === totalForms ? 'fully operational' : 'partially ready'}.`);
        }

        // Embed Code Library Functions
        function copyEmbedCode(formId, formName) {
            const form = FORMS_DATA.forms.find(f => f.id === formId);
            if (!form) {
                alert('Form not found');
                return;
            }

            const categoryDir = form.category.toLowerCase();
            const surveyPath = `surveys/${categoryDir}/${formName}-screener-live.html`;
            
            const embedCode = `<!-- ${formName} Medical Screening Form -->
<div id="locumtele-${formName.toLowerCase()}-form" style="width: 100%; max-width: 800px; margin: 0 auto;"></div>
<script>
(function() {
    fetch('${surveyPath}')
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const formContent = doc.body.innerHTML;
            
            const container = document.getElementById('locumtele-${formName.toLowerCase()}-form');
            if (container) {
                container.innerHTML = formContent;
                
                const scripts = container.querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.head.appendChild(newScript);
                });
            }
        })
        .catch(error => {
            console.error('Error loading LocumTele form:', error);
            const container = document.getElementById('locumtele-${formName.toLowerCase()}-form');
            if (container) {
                container.innerHTML = '<p style="color: #dc3545; text-align: center; padding: 2rem;">Form temporarily unavailable. Please try again later.</p>';
            }
        });
})();
<\/script>
<!-- End ${formName} Form -->`;

            navigator.clipboard.writeText(embedCode).then(() => {
                showNotification(`üìã Copied embed code for ${formName}!`, 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = embedCode;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification(`üìã Copied embed code for ${formName}!`, 'success');
            });
        }

        function previewEmbed(formId, formName) {
            const form = FORMS_DATA.forms.find(f => f.id === formId);
            if (!form) {
                alert('Form not found');
                return;
            }

            const categoryDir = form.category.toLowerCase();
            const surveyPath = `surveys/${categoryDir}/${formName}-screener-live.html`;
            
            // Open in new tab
            window.open(surveyPath, '_blank');
        }

        function copyAllEmbedCodes() {
            const readyForms = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                return form.name === 'GLP1' && categoryDir === 'weightloss';
            });

            if (readyForms.length === 0) {
                alert('No embed codes available to copy.');
                return;
            }

            const allCodes = readyForms.map(form => {
                const categoryDir = form.category.toLowerCase();
                const surveyPath = `surveys/${categoryDir}/${form.name}-screener-live.html`;
                
                return `<!-- ${form.name} Medical Screening Form -->
<div id="locumtele-${form.name.toLowerCase()}-form" style="width: 100%; max-width: 800px; margin: 0 auto;"></div>
<script>
(function() {
    fetch('${surveyPath}')
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const formContent = doc.body.innerHTML;
            
            const container = document.getElementById('locumtele-${form.name.toLowerCase()}-form');
            if (container) {
                container.innerHTML = formContent;
                
                const scripts = container.querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.head.appendChild(newScript);
                });
            }
        })
        .catch(error => {
            console.error('Error loading LocumTele form:', error);
            const container = document.getElementById('locumtele-${form.name.toLowerCase()}-form');
            if (container) {
                container.innerHTML = '<p style="color: #dc3545; text-align: center; padding: 2rem;">Form temporarily unavailable. Please try again later.</p>';
            }
        });
})();
<\/script>
<!-- End ${form.name} Form -->`;
            }).join('\n\n');

            navigator.clipboard.writeText(allCodes).then(() => {
                showNotification(`üìã Copied ${readyForms.length} embed codes!`, 'success');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = allCodes;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification(`üìã Copied ${readyForms.length} embed codes!`, 'success');
            });
        }

        function generateDeploymentReport() {
            const readyForms = FORMS_DATA.forms.filter(form => {
                const categoryDir = form.category.toLowerCase();
                return form.name === 'GLP1' && categoryDir === 'weightloss';
            });

            const report = `üìä LocumTele Survey Deployment Report
Generated: ${new Date().toLocaleString()}

Available Embed Codes: ${readyForms.length}

${readyForms.map(form => `
‚Ä¢ ${form.name} (${form.category})
  - Questions: ${form.questionCount}
  - Status: Ready for deployment
  - Path: surveys/${form.category.toLowerCase()}/${form.name}-screener-live.html
`).join('')}

Instructions:
1. Copy the embed code for each survey
2. Paste into client website HTML
3. Forms will load automatically with full functionality
4. Data submits to configured endpoints

For support, contact the development team.`;

            navigator.clipboard.writeText(report).then(() => {
                showNotification('üìä Deployment report copied to clipboard!', 'success');
            }).catch(() => {
                alert(report);
            });
        }

        function filterEmbedLibrary() {
            const searchTerm = document.getElementById('embedSearch').value.toLowerCase();
            const activeCategory = document.querySelector('.category-toggle.active')?.getAttribute('data-category') || '';
            const rows = document.querySelectorAll('.embed-row');

            rows.forEach(row => {
                const name = row.getAttribute('data-name');
                const category = row.getAttribute('data-category');
                
                const matchesSearch = name.includes(searchTerm);
                const matchesCategory = !activeCategory || category === activeCategory;
                
                if (matchesSearch && matchesCategory) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function toggleCategory(category, button) {
            // Update active button
            document.querySelectorAll('.category-toggle').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');

            // Filter the table
            filterEmbedLibrary();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                font-weight: 500;
                z-index: 10000;
                max-width: 400px;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function exportData() {
            alert('Exporting all data...');
        }

        function openSearch() {
            alert('Opening search interface...');
        }

        function createNewForm() {
            alert('Creating new form...');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.dashboard-mobile-toggle');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !toggle.contains(event.target)) {
                sidebar.classList.remove('open');
            }
        });

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Load the forms page by default
            loadPage('forms');
        });
    </script>
</body>
</html>

