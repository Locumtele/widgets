
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAD Assessment</title>
    <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: transparent;
                color: #333;
                line-height: 1.6;
            }

            .form-wrapper {
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
            }

            /* Fixed Title Container */
            .title-container {
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                margin-bottom: 20px;
                text-align: center;
            }

            .form-title {
                font-size: 2rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 10px;
            }

            .form-subtitle {
                font-size: 1.1rem;
                color: #666;
                text-align: center;
                margin-bottom: 20px;
                font-weight: 400;
            }

            .progress-container {
                margin-top: 20px;
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: #f0f0f0;
                border-radius: 4px;
                overflow: hidden;
                margin-bottom: 10px;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #333 0%, #555 100%);
                transition: width 0.3s ease;
            }

            .progress-text {
                font-size: 0.9rem;
                color: #666;
            }

            /* Survey Container */
            .survey-container {
                background: white;
                padding: 40px;
                border-radius: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }

            .section {
                display: none;
            }

            .section.active {
                display: block;
            }

            .section-title {
                font-size: 1.5rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 30px;
                padding-bottom: 15px;
                border-bottom: 2px solid #f0f0f0;
            }

            .questions-container {
                margin-bottom: 40px;
            }

            .question-wrapper {
                margin-bottom: 30px;
            }

            .question-wrapper.question-hidden {
                display: none;
            }

            .question-container {
                margin-bottom: 20px;
            }

            .question-label {
                display: block;
                font-weight: 600;
                color: #333;
                margin-bottom: 12px;
                font-size: 1rem;
            }

            .required-asterisk {
                color: #e74c3c;
                margin-left: 4px;
            }

            .answer-container {
                margin-bottom: 10px;
            }

            /* Form Inputs */
            .form-input {
                width: 100%;
                padding: 14px 16px;
                border: 2px solid #e1e5e9;
                border-radius: 8px;
                font-size: 1rem;
                transition: border-color 0.2s ease;
                background: white;
            }

            .form-input:focus {
                outline: none;
                border-color: #333;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

            /* Radio and Checkbox Groups */
            .radio-group, .checkbox-group {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-top: 10px;
            }

            .radio-option, .checkbox-option {
                display: flex;
                align-items: center;
                cursor: pointer;
                padding: 12px 16px;
                border: 2px solid #e1e5e9;
                border-radius: 8px;
                transition: all 0.2s ease;
                background: white;
            }

            .radio-option:hover, .checkbox-option:hover {
                border-color: #333;
                background: #f8f9ff;
            }

            .radio-option input, .checkbox-option input {
                margin-right: 12px;
                transform: scale(1.2);
            }

            /* Height and Weight Inputs - 3 Column Layout */
            .height-weight-container {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 15px;
                max-width: 500px;
            }

            .height-input-group, .weight-input-group {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .height-input, .weight-input {
                flex: 1;
                min-width: 80px;
                width: 100%;
            }

            .input-suffix {
                font-weight: 600;
                color: #666;
                font-size: 0.9rem;
            }

            /* File Input */
            .file-input-container {
                position: relative;
            }

            .file-input {
                opacity: 0;
                position: absolute;
                z-index: -1;
            }

            .file-input-label {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 14px 16px;
                border: 2px dashed #e1e5e9;
                border-radius: 8px;
                cursor: pointer;
                transition: border-color 0.2s ease;
                background: white;
            }

            .file-input-label:hover {
                border-color: #333;
            }

            .file-input-label.file-selected {
                border-color: #28a745;
                background: #f8fff9;
            }

            .file-input-button {
                background: #333;
                color: white;
                padding: 8px 16px;
                border-radius: 6px;
                font-size: 0.9rem;
                font-weight: 600;
            }

            /* BMI Display */
            .bmi-display-section {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid #e1e5e9;
            }

            .formula-display {
                padding: 15px;
                background: #f8f9fa;
                border: 2px solid #e1e5e9;
                border-radius: 8px;
                text-align: center;
            }

            .bmi-result {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                font-size: 1.1rem;
            }

            .bmi-value {
                font-weight: 600;
                color: #333;
            }

            /* Disqualification Message */
            .disqualification-message {
                margin-top: 15px;
                padding: 16px 20px;
                background: linear-gradient(135deg, #fff 0%, #fef7f7 100%);
                border: 1px solid #f0a6a6;
                border-radius: 12px;
                color: #2d2d2d;
                font-weight: 500;
                line-height: 1.6;
                white-space: pre-line;
                border-left: 4px solid #e74c3c;
                box-shadow: 0 2px 8px rgba(231, 76, 60, 0.1);
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            }

            /* Navigation Buttons */
            .form-navigation {
                display: flex;
                justify-content: flex-end;
                gap: 20px;
                margin-top: 40px;
                padding-top: 30px;
                border-top: 2px solid #f0f0f0;
            }

            .form-navigation.has-prev {
                justify-content: space-between;
            }

            .nav-btn {
                padding: 14px 28px;
                border: none;
                border-radius: 8px;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
                min-width: 120px;
            }

            .prev-btn {
                background: #f1f3f4;
                color: #333;
            }

            .prev-btn:hover {
                background: #e8eaed;
            }

            .next-btn, .submit-btn {
                background: linear-gradient(90deg, #333 0%, #555 100%);
                color: white;
            }

            .next-btn:hover, .submit-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            }

            .next-btn:disabled, .submit-btn:disabled {
                background: #e1e5e9;
                color: #999;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            /* Mobile Responsiveness */
            @media (max-width: 768px) {
                .form-wrapper {
                    padding: 10px;
                }

                .title-container, .survey-container {
                    padding: 20px;
                }

                .form-title {
                    font-size: 1.5rem;
                }

                .radio-group, .checkbox-group {
                    grid-template-columns: 1fr;
                    gap: 10px;
                }

                .height-weight-container {
                    grid-template-columns: 1fr;
                    gap: 10px;
                }

                .form-navigation {
                    flex-direction: column;
                }

                .nav-btn {
                    width: 100%;
                }
            }
        </style>
</head>
<body>
    <div class="form-wrapper">
        <!-- Fixed Title Container -->
        <div class="title-container">
            <h1 class="form-title">NAD Assessment</h1>
            <p class="form-subtitle">See if you prequalify by completing this questionnaire</p>
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 20%;"></div>
                </div>
                <span class="progress-text">Section 1 of 5</span>
            </div>
        </div>

        <!-- Survey Container (changes per section) -->
        <div class="survey-container">
            <form id="medicalForm" class="medical-form" data-category="antiaging" data-consult-type="async">
                
                <div class="section active" id="section-1">
                    <h2 class="section-title">Patient Profile</h2>
                    <div class="questions-container">
            
            <div class="question-wrapper "
                 data-question-id="SQE0A2"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQE0A2">
                        Full Name
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQE0A2"
                   name="SQE0A2"
                   class="form-input"
                   autocomplete="name"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQEEA9"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQEEA9">
                        Email Address
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="email"
                   id="SQEEA9"
                   name="SQEEA9"
                   class="form-input"
                   autocomplete="email"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQE18D"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQE18D">
                        Phone Number
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="tel"
                   id="SQE18D"
                   name="SQE18D"
                   class="form-input"
                   autocomplete="tel"
                   oninput="formatPhoneInput(this)" maxlength="14" placeholder="(555) 123-4567"
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQE74D"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQE74D">
                        Date of Birth
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="date"
                   id="SQE74D"
                   name="SQE74D"
                   class="form-input date-input"
                   required
                   onchange="validateAge(this)">
        
                    </div>

                    <!-- Disqualification message container -->
                    <div class="disqualification-message" style="display: none;">You must be 18 years or older to use this service.</div>
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQCFA9"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQCFA9">
                        Gender
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQCFA9"
                           value="female"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Female
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQCFA9"
                           value="male"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Male
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper question-hidden"
                 data-question-id="SQF24B"
                 data-show-condition="if_gender_female">
                <div class="question-container">
                    <label class="question-label" for="SQF24B">
                        Are you currently pregnant or breastfeeding?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQF24B"
                           value="yes"
                           data-answer-type="disqualify"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Yes
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQF24B"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    <div class="disqualification-message" style="display: none;">For your safety and your baby's wellbeing, this treatment is not recommended during pregnancy or breastfeeding.</div>
                </div>
            </div>
        
            <div class="question-wrapper" data-question-group="height-weight">
                <div class="question-container">
                    <label class="question-label">
                        Height and Weight
                        <span class="required-asterisk">*</span>
                    </label>
                    <div class="answer-container">
                        <div class="height-weight-container">
                            
            <div class="height-input-group">
                <input type="number"
                       id="SQFA2B"
                       name="SQFA2B"
                       class="form-input height-input"
                       min="3" max="8"
                       placeholder="Feet"
                       onchange="calculateBMI()">
                <span class="input-suffix">ft</span>
            </div>
        
                            
            <div class="height-input-group">
                <input type="number"
                       id="SQEC6B"
                       name="SQEC6B"
                       class="form-input height-input"
                       min="0" max="11"
                       placeholder="Inches"
                       onchange="calculateBMI()">
                <span class="input-suffix">in</span>
            </div>
        
                            
            <div class="weight-input-group">
                <input type="number"
                       id="SQ2BFB"
                       name="SQ2BFB"
                       class="form-input weight-input"
                       min="50" max="500"
                       placeholder="Weight"
                       onchange="calculateBMI()">
                <span class="input-suffix">lbs</span>
            </div>
        
                        </div>
                        <div class="bmi-display-section">
                            <div class="formula-display">
                                <div id="patient-profile-bmi" class="bmi-result">
                                    <span class="bmi-label">BMI: </span>
                                    <span class="bmi-value" id="bmi-value">Enter height and weight above</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
                    </div>
                </div>
            
                <div class="section" id="section-2">
                    <h2 class="section-title">Assessment</h2>
                    <div class="questions-container">
            
            <div class="question-wrapper "
                 data-question-id="SQDD03"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQDD03">
                        Have you ever had an adverse or allergic reaction to NAD (nicotinamide adenosine dinucleotide) or NR (nicotinamide riboside)?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQDD03"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQFC39"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQFC39">
                        Have you previously received NAD IV infusions, IM injections, Nasal Spray, or topical?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQFC39"
                           value="yes"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Yes
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQFC39"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper question-hidden"
                 data-question-id="SQF307"
                 data-show-condition="if_nad_supp_yes">
                <div class="question-container">
                    <label class="question-label" for="SQF307">
                        If yes, which supplement and at what dose?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQF307"
                   name="SQF307"
                   class="form-input"
                   autocomplete="off"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQDE6A"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQDE6A">
                        Are you currently receiving NAD treatments elsewhere?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQDE6A"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper question-hidden"
                 data-question-id="SQF4B1"
                 data-show-condition="if_current_nad_yes">
                <div class="question-container">
                    <label class="question-label" for="SQF4B1">
                        If yes, what dose?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQF4B1"
                   name="SQF4B1"
                   class="form-input"
                   autocomplete="off"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQDD7D"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQDD7D">
                        What is your preferred route for NAD administration?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQDD7D"
                           value="im_sq"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Im Sq
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQDD7D"
                           value="nasal"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Nasal
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQDD7D"
                           value="patch"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Patch
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQDD7D"
                           value="topical"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Topical
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQCA92"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQCA92">
                        Do you have a history of heart disease or cardiovascular disease?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQCA92"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
                    </div>
                </div>
            
                <div class="section" id="section-3">
                    <h2 class="section-title">Medical History</h2>
                    <div class="questions-container">
            
            <div class="question-wrapper "
                 data-question-id="SQE290"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQE290">
                        What is your exercise level?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQE290"
                           value="high"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    High
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQE290"
                           value="low"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Low
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQE290"
                           value="moderate"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Moderate
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQF06B"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQF06B">
                        Do you have any allergies?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQF06B"
                           value="yes"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Yes
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQF06B"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper question-hidden"
                 data-question-id="SQE24A"
                 data-show-condition="if_allergies_yes">
                <div class="question-container">
                    <label class="question-label" for="SQE24A">
                        If yes, please list your allergies
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQE24A"
                   name="SQE24A"
                   class="form-input"
                   autocomplete="off"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQD6F6"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQD6F6">
                        Do you currently use tobacco or vape?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQD6F6"
                           value="yes"
                           data-answer-type="flag"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Yes
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQD6F6"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper question-hidden"
                 data-question-id="SQCE76"
                 data-show-condition="if_tobacco_use_yes">
                <div class="question-container">
                    <label class="question-label" for="SQCE76">
                        What type of tobacco/vaping products and how frequently?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQCE76"
                   name="SQCE76"
                   class="form-input"
                   autocomplete="off"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQEEA9"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQEEA9">
                        Are you currently receiving chemotherapy?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQEEA9"
                           value="yes"
                           data-answer-type="disqualify"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Yes
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQEEA9"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    <div class="disqualification-message" style="display: none;">While receiving cancer treatment, it's important to focus on your current therapy. Please discuss your healthcare goals with your oncology team.</div>
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQFA11"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQFA11">
                        Are you currently experiencing depression with history of suicidal attempts, thoughts, or ideation?
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <div class="radio-group">
                <label class="radio-option">
                    <input type="radio"
                           name="SQFA11"
                           value="yes"
                           data-answer-type="disqualify"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    Yes
                </label>
            
                <label class="radio-option">
                    <input type="radio"
                           name="SQFA11"
                           value="no"
                           data-answer-type="safe"
                           autocomplete="off"
                           onchange="handleAnswerChange(this)">
                    <span class="radio-checkmark"></span>
                    No
                </label>
            </div>
                    </div>

                    <!-- Disqualification message container -->
                    <div class="disqualification-message" style="display: none;"> We care about your safety.

Because you indicated that you are feeling depressed or having thoughts of
suicide, you are not eligible to continue at this time.

You are not alone, and help is available:
• Call or text 988 to connect with the Suicide & Crisis Lifeline.
• If you are in immediate danger of harming yourself, call 911 or go to
the nearest Emergency Department.

Your wellbeing is our top priority.</div>
                </div>
            </div>
        
                    </div>
                </div>
            
                <div class="section" id="section-4">
                    <h2 class="section-title">Verification</h2>
                    <div class="questions-container">
            
            <div class="question-wrapper "
                 data-question-id="SQF786"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQF786">
                        Address
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQF786"
                   name="SQF786"
                   class="form-input"
                   autocomplete="off"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQD08E"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQD08E">
                        Address 2
                        
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQD08E"
                   name="SQD08E"
                   class="form-input"
                   autocomplete="off"
                   
                   >
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQD394"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQD394">
                        City
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <input type="text"
                   id="SQD394"
                   name="SQD394"
                   class="form-input"
                   autocomplete="off"
                   
                   required>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQE322"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQE322">
                        State
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
                <select id="SQE322" name="SQE322" class="form-input state-select" required>
                    <option value="">Choose your state...</option><option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="DC">District of Columbia</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
                </select>
            
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQF172"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQF172">
                        Postal Code
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        <input type="text" id="SQF172" name="SQF172" class="form-input">
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
            <div class="question-wrapper "
                 data-question-id="SQCAB0"
                 data-show-condition="always">
                <div class="question-container">
                    <label class="question-label" for="SQCAB0">
                        Upload government ID (driver's license) for identity verification
                         <span class="required-asterisk">*</span>
                    </label>

                    <div class="answer-container">
                        
            <div class="file-input-container">
                <input type="file"
                       id="SQCAB0"
                       name="SQCAB0"
                       class="file-input"
                       accept="image/*,.pdf"
                       onchange="handleFileUpload(this)">
                <label for="SQCAB0" class="file-input-label">
                    <span class="file-input-text" id="SQCAB0_text">Choose File</span>
                    <span class="file-input-button">Browse</span>
                </label>
            </div>
        
                    </div>

                    <!-- Disqualification message container -->
                    
                </div>
            </div>
        
                    </div>
                </div>
            

                <!-- Navigation Buttons -->
                <div class="form-navigation">
                    <button type="button" id="prevBtn" class="nav-btn prev-btn" style="display: none;">Previous</button>
                    <button type="button" id="nextBtn" class="nav-btn next-btn">Next</button>
                    <button type="submit" id="submitBtn" class="nav-btn submit-btn" style="display: none;">Complete Screening</button>
                </div>
            </form>
        </div>
    </div>

    <script>
            // Form state
            let currentSection = 1;
            const totalSections = 4;
            let formData = {};
            let isDisqualified = false;
            let errorMessages = new Map();

            // Local storage key for this form
            const storageKey = 'medicalForm_NAD_antiaging';

            // Sync-only states
            const syncOnlyStates = ["AR", "DC", "DE", "ID", "KS", "LA", "MS", "NM", "RI", "WV", "NC", "SC", "ME"];

            // Initialize form
            document.addEventListener('DOMContentLoaded', function() {
                resetFormState();
                loadFormData();
                updateProgressBar();
                setupEventListeners();
                setupConditionalLogic();
                calculateBMI();
            });

            function formatPhoneInput(input) {
                // Remove all non-digit characters
                let value = input.value.replace(/\D/g, '');

                // Limit to 10 digits
                if (value.length > 10) {
                    value = value.substring(0, 10);
                }

                // Format as (XXX) XXX-XXXX
                if (value.length >= 6) {
                    value = `(${value.substring(0, 3)}) ${value.substring(3, 6)}-${value.substring(6)}`;
                } else if (value.length >= 3) {
                    value = `(${value.substring(0, 3)}) ${value.substring(3)}`;
                } else if (value.length > 0) {
                    value = `(${value}`;
                }

                input.value = value;
            }

            function resetFormState() {
                // Clear any problematic localStorage data
                const savedData = localStorage.getItem(storageKey);
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        // If data contains 'no' as values, clear it
                        if (data.formData && Object.values(data.formData).some(val => val === 'no' && typeof val === 'string')) {
                            localStorage.removeItem(storageKey);
                        }
                    } catch (e) {
                        localStorage.removeItem(storageKey);
                    }
                }

                // Ensure all radio buttons start unselected unless saved data exists
                setTimeout(() => {
                    const allRadios = document.querySelectorAll('input[type="radio"]');
                    allRadios.forEach(radio => {
                        radio.checked = false;
                        radio.removeAttribute('checked');
                    });

                    // Also reset checkboxes to be safe
                    const allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
                    allCheckboxes.forEach(checkbox => {
                        checkbox.checked = false;
                        checkbox.removeAttribute('checked');
                    });
                }, 100);
            }

            function loadFormData() {
                try {
                    const savedData = localStorage.getItem(storageKey);
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        formData = data.formData || {};
                        currentSection = data.currentSection || 1;

                        // Restore form values
                        Object.keys(formData).forEach(name => {
                            const input = document.querySelector(`[name="${name}"]`);
                            if (input) {
                                if (input.type === 'radio' || input.type === 'checkbox') {
                                    if (input.value === formData[name]) {
                                        input.checked = true;
                                    }
                                } else if (input.type === 'file') {
                                    // Handle file uploads - show filename if available
                                    const fileData = formData[name];
                                    if (fileData && typeof fileData === 'object' && fileData.filename) {
                                        const textElement = document.getElementById(input.id + '_text');
                                        const label = input.closest('.file-input-container').querySelector('.file-input-label');
                                        if (textElement && label) {
                                            textElement.textContent = fileData.filename;
                                            label.classList.add('file-selected');
                                        }
                                    }
                                } else {
                                    input.value = formData[name];
                                }
                            }
                        });

                        // Update UI to match restored section
                        if (currentSection > 1) {
                            for (let i = 1; i < currentSection; i++) {
                                document.getElementById(`section-${i}`).classList.remove('active');
                            }
                            document.getElementById(`section-${currentSection}`).classList.add('active');
                        }
                    }
                } catch (error) {
                    console.log('No previous form data found');
                }
            }

            function saveFormData() {
                try {
                    const dataToSave = {
                        formData: formData,
                        currentSection: currentSection,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem(storageKey, JSON.stringify(dataToSave));
                } catch (error) {
                    console.log('Could not save form data');
                }
            }

            function clearFormData() {
                try {
                    localStorage.removeItem(storageKey);
                } catch (error) {
                    console.log('Could not clear form data');
                }
            }

            function setupEventListeners() {
                // Navigation buttons
                document.getElementById('nextBtn').addEventListener('click', nextSection);
                document.getElementById('prevBtn').addEventListener('click', prevSection);
                document.getElementById('submitBtn').addEventListener('click', submitForm);

                // Height/weight inputs for BMI calculation
                const heightFeet = document.querySelector('input[name*="SQ48"]');
                const heightInches = document.querySelector('input[name*="SQ49"]');
                const weight = document.querySelector('input[name*="SQ2"]');

                if (heightFeet) heightFeet.addEventListener('input', calculateBMI);
                if (heightInches) heightInches.addEventListener('input', calculateBMI);
                if (weight) weight.addEventListener('input', calculateBMI);
            }

            function setupConditionalLogic() {
                // Set up conditional question display
                const questions = document.querySelectorAll('[data-show-condition]');
                questions.forEach(question => {
                    const condition = question.dataset.showCondition;
                    if (condition !== 'always') {
                        question.classList.add('question-hidden');
                    }
                });

                // Set up listeners for trigger inputs
                // Gender questions (triggers pregnancy question)
                const genderInputs = document.querySelectorAll('input[type="radio"][value="female"], input[type="radio"][value="male"]');
                genderInputs.forEach(input => {
                    input.addEventListener('change', updateConditionalQuestions);
                });

                // Allergy questions (triggers allergy detail question)
                const allergyInputs = document.querySelectorAll('input[type="radio"][value="yes"], input[type="radio"][value="no"]');
                allergyInputs.forEach(input => {
                    if (input.closest('.question-container').querySelector('label[class*="question-label"]')?.textContent?.includes('allergies')) {
                        input.addEventListener('change', updateConditionalQuestions);
                    }
                });

                // Other GLP-1 medication questions (triggers dosage question)
                const medicationInputs = document.querySelectorAll('input[type="checkbox"][value*="glp1"], input[type="checkbox"][value*="other_glp1"]');
                medicationInputs.forEach(input => {
                    input.addEventListener('change', updateConditionalQuestions);
                });
            }

            function updateConditionalQuestions() {
                // Update visibility of conditional questions
                const questions = document.querySelectorAll('[data-show-condition]');
                questions.forEach(question => {
                    const condition = question.dataset.showCondition;
                    checkQuestionVisibility(question, condition);
                });
            }

            function checkQuestionVisibility(questionElement, condition) {
                let shouldShow = false;

                if (condition === 'always') {
                    shouldShow = true;
                } else if (condition === 'if_gender_female') {
                    const genderInput = document.querySelector('input[type="radio"][value="female"]:checked');
                    shouldShow = genderInput && genderInput.value === 'female';
                } else if (condition === 'if_allergies_yes') {
                    // Find the checked radio button with value "yes" in any allergy question
                    const allergyInputs = document.querySelectorAll('input[type="radio"][value="yes"]:checked');
                    for (let input of allergyInputs) {
                        const questionText = input.closest('.question-container').querySelector('label[class*="question-label"]')?.textContent;
                        if (questionText && questionText.toLowerCase().includes('allergies')) {
                            shouldShow = true;
                            break;
                        }
                    }
                } else if (condition === 'if_other_glp1s_yes') {
                    // Check if any "other_glp1" checkbox is checked
                    const glp1Input = document.querySelector('input[type="checkbox"][value*="other_glp1"]:checked');
                    shouldShow = glp1Input !== null;
                } else if (condition === 'if_tobacco_yes' || condition === 'if_tobacco_use_yes') {
                    // Find the checked radio button with value "yes" in any tobacco question
                    const tobaccoInputs = document.querySelectorAll('input[type="radio"][value="yes"]:checked');
                    for (let input of tobaccoInputs) {
                        const questionText = input.closest('.question-container').querySelector('label[class*="question-label"]')?.textContent;
                        if (questionText && (questionText.toLowerCase().includes('tobacco') || questionText.toLowerCase().includes('vape'))) {
                            shouldShow = true;
                            break;
                        }
                    }
                }

                if (shouldShow) {
                    questionElement.classList.remove('question-hidden');
                } else {
                    questionElement.classList.add('question-hidden');
                    // Clear values when hidden
                    const inputs = questionElement.querySelectorAll('input, select, textarea');
                    inputs.forEach(input => {
                        if (input.type === 'radio' || input.type === 'checkbox') {
                            input.checked = false;
                        } else {
                            input.value = '';
                        }
                    });
                    // Clear any error messages
                    const questionId = questionElement.dataset.questionId;
                    if (questionId && errorMessages.has(questionId)) {
                        errorMessages.delete(questionId);
                        const disqualMsg = questionElement.querySelector('.disqualification-message');
                        if (disqualMsg) disqualMsg.style.display = 'none';
                    }
                }
            }

            function handleAnswerChange(input) {
                const answerType = input.dataset.answerType;
                const questionWrapper = input.closest('.question-wrapper');
                const disqualificationMsg = questionWrapper.querySelector('.disqualification-message');
                const questionId = questionWrapper.dataset.questionId;

                // For checkbox questions, check if ANY disqualifying options are checked
                if (input.type === 'checkbox') {
                    const allCheckboxes = questionWrapper.querySelectorAll('input[type="checkbox"]');
                    const disqualifyingChecked = Array.from(allCheckboxes).some(cb =>
                        cb.checked && cb.dataset.answerType === 'disqualify');

                    if (disqualifyingChecked) {
                        // Show disqualification message
                        if (disqualificationMsg) {
                            disqualificationMsg.style.display = 'block';
                            errorMessages.set(questionId, true);
                            isDisqualified = true;
                        }
                    } else {
                        // Hide disqualification message
                        if (disqualificationMsg) {
                            disqualificationMsg.style.display = 'none';
                            errorMessages.delete(questionId);
                        }
                    }

                    // Store checkbox values as array
                    const checkedValues = Array.from(allCheckboxes)
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    formData[input.name] = checkedValues;
                } else {
                    // Radio button logic
                    // Clear existing error state for this question
                    if (errorMessages.has(questionId)) {
                        errorMessages.delete(questionId);
                        if (disqualificationMsg) {
                            disqualificationMsg.style.display = 'none';
                        }
                    }

                    if (answerType === 'disqualify') {
                        // Show disqualification message
                        if (disqualificationMsg) {
                            disqualificationMsg.style.display = 'block';
                            errorMessages.set(questionId, true);
                            isDisqualified = true;
                        }
                    } else if (answerType === 'flag') {
                        // Just add flag class, no disqualification
                        questionWrapper.classList.add('flagged');
                    }

                    // Store single value for radio buttons
                    formData[input.name] = input.value;
                }

                // Update conditional questions based on this answer
                updateConditionalQuestions();

                // Save form data
                saveFormData();
            }

            function calculateBMI() {
                // Find height and weight inputs dynamically by looking for the pattern in Patient Profile
                const heightFeetInput = document.querySelector('input[placeholder*="Feet"], input[class*="height-input"][id*="ft"], input[name*="feet"]') ||
                                       Array.from(document.querySelectorAll('input')).find(input =>
                                           input.closest('.question-container')?.textContent?.includes('Height') &&
                                           input.closest('.question-container')?.textContent?.includes('feet'));

                const heightInchesInput = document.querySelector('input[placeholder*="Inches"], input[class*="height-input"][id*="in"], input[name*="inches"]') ||
                                         Array.from(document.querySelectorAll('input')).find(input =>
                                             input.closest('.question-container')?.textContent?.includes('Height') &&
                                             input.closest('.question-container')?.textContent?.includes('inches'));

                const weightInput = document.querySelector('input[placeholder*="Weight"], input[class*="weight-input"], input[name*="weight"]') ||
                                   Array.from(document.querySelectorAll('input')).find(input =>
                                       input.closest('.question-container')?.textContent?.includes('Weight') &&
                                       input.closest('.question-container')?.textContent?.includes('pounds'));

                const heightFeet = heightFeetInput?.value;
                const heightInches = heightInchesInput?.value;
                const weight = weightInput?.value;
                const bmiDisplay = document.getElementById('bmi-value');

                if (heightFeet && heightInches && weight && bmiDisplay) {
                    const totalInches = (parseInt(heightFeet) * 12) + parseInt(heightInches);
                    const bmi = (parseFloat(weight) * 703) / (totalInches * totalInches);

                    if (!isNaN(bmi)) {
                        bmiDisplay.textContent = bmi.toFixed(1);
                        formData.bmi = bmi.toFixed(1);

                        // Check BMI disqualification for GLP1 specifically (only if form name includes GLP1)
                        if ('NAD'.includes('GLP1') && bmi < 25) {
                            // Find BMI question in Assessment section if it exists
                            const assessmentBmiQuestion = document.querySelector('[data-question-id*="BMI"], [data-question-id*="bmi"], .bmi-result').closest('.question-wrapper');
                            if (assessmentBmiQuestion) {
                                const questionId = assessmentBmiQuestion.getAttribute('data-question-id');
                                let disqualMsg = assessmentBmiQuestion.querySelector('.disqualification-message');

                                // Create disqualification message if it doesn't exist
                                if (!disqualMsg) {
                                    disqualMsg = document.createElement('div');
                                    disqualMsg.className = 'disqualification-message';
                                    disqualMsg.textContent = 'A BMI of 25 or higher is required for this program.';
                                    assessmentBmiQuestion.querySelector('.question-container').appendChild(disqualMsg);
                                }

                                disqualMsg.style.display = 'block';
                                errorMessages.set(questionId, true);
                                isDisqualified = true;
                            }
                        } else {
                            // Clear BMI disqualification if BMI is now acceptable
                            const assessmentBmiQuestion = document.querySelector('[data-question-id*="BMI"], [data-question-id*="bmi"], .bmi-result').closest('.question-wrapper');
                            if (assessmentBmiQuestion) {
                                const questionId = assessmentBmiQuestion.getAttribute('data-question-id');
                                const disqualMsg = assessmentBmiQuestion.querySelector('.disqualification-message');
                                if (disqualMsg) {
                                    disqualMsg.style.display = 'none';
                                    errorMessages.delete(questionId);
                                }
                            }
                        }
                    }
                } else if (bmiDisplay) {
                    bmiDisplay.textContent = 'Enter height and weight above';
                }
            }

            function handleFileUpload(input) {
                const textElement = document.getElementById(input.id + '_text');
                const label = input.closest('.file-input-container').querySelector('.file-input-label');

                if (input.files && input.files.length > 0) {
                    const file = input.files[0];
                    const fileName = file.name;

                    // Validate file size (10MB limit)
                    if (file.size > 10 * 1024 * 1024) {
                        alert('File size must be less than 10MB');
                        input.value = '';
                        return;
                    }

                    // Validate file type
                    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf'];
                    if (!allowedTypes.includes(file.type)) {
                        alert('Please upload an image (JPEG, PNG, GIF) or PDF file');
                        input.value = '';
                        return;
                    }

                    // Update UI
                    textElement.textContent = fileName;
                    label.classList.add('file-selected');

                    // Convert file to base64 for API transmission
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        formData[input.name] = {
                            filename: fileName,
                            fileType: file.type,
                            fileSize: file.size,
                            fileData: e.target.result // base64 data
                        };
                        saveFormData(); // Save to localStorage
                    };
                    reader.readAsDataURL(file);

                } else {
                    textElement.textContent = 'Choose File';
                    label.classList.remove('file-selected');
                    delete formData[input.name];
                    saveFormData();
                }
            }

            function validateAge(dateInput) {
                const birthDate = new Date(dateInput.value);
                const today = new Date();
                const age = Math.floor((today - birthDate) / (365.25 * 24 * 60 * 60 * 1000));
                const questionWrapper = dateInput.closest('.question-wrapper');
                const questionId = questionWrapper.dataset.questionId;
                const disqualificationMsg = questionWrapper.querySelector('.disqualification-message');

                // Clear previous date errors
                dateInput.setCustomValidity('');

                if (isNaN(age) || age < 0 || age > 120) {
                    dateInput.setCustomValidity('Please enter a valid date of birth');
                    return;
                }

                if (age < 18) {
                    // Show age disqualification
                    if (disqualificationMsg) {
                        disqualificationMsg.style.display = 'block';
                        errorMessages.set(questionId, true);
                        isDisqualified = true;
                    }
                } else {
                    // Clear age disqualification
                    if (disqualificationMsg) {
                        disqualificationMsg.style.display = 'none';
                        errorMessages.delete(questionId);
                    }
                }
            }

            function nextSection() {
                if (!validateCurrentSection()) {
                    return;
                }

                // For BMI-related sections, allow progression to Assessment to see BMI value
                // before showing disqualification message
                const isLeavingPatientProfile = currentSection === 1;
                const hasDisqualifyingBMI = errorMessages.has('SQ50'); // BMI question ID

                if (errorMessages.size > 0 && !(isLeavingPatientProfile && hasDisqualifyingBMI)) {
                    alert('Please review your answers. Some responses may affect your eligibility.');
                    return;
                }

                if (currentSection < totalSections) {
                    document.getElementById(`section-${currentSection}`).classList.remove('active');
                    currentSection++;
                    document.getElementById(`section-${currentSection}`).classList.add('active');
                    updateProgressBar();
                    updateNavigationButtons();

                    // Scroll to top of new section
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            function prevSection() {
                if (currentSection > 1) {
                    document.getElementById(`section-${currentSection}`).classList.remove('active');
                    currentSection--;
                    document.getElementById(`section-${currentSection}`).classList.add('active');
                    updateProgressBar();
                    updateNavigationButtons();

                    // Scroll to top of new section
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            function updateProgressBar() {
                const progress = (currentSection / totalSections) * 100;
                document.querySelector('.progress-fill').style.width = progress + '%';
                document.querySelector('.progress-text').textContent = `Section ${currentSection} of ${totalSections}`;
            }

            function updateNavigationButtons() {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                const navigation = document.querySelector('.form-navigation');

                const showPrev = currentSection > 1;
                prevBtn.style.display = showPrev ? 'inline-block' : 'none';
                nextBtn.style.display = currentSection < totalSections ? 'inline-block' : 'none';
                submitBtn.style.display = currentSection === totalSections ? 'inline-block' : 'none';

                // Add conditional class for navigation alignment
                if (showPrev) {
                    navigation.classList.add('has-prev');
                } else {
                    navigation.classList.remove('has-prev');
                }
            }

            function validateCurrentSection() {
                const currentSectionElement = document.getElementById(`section-${currentSection}`);
                const visibleRequiredInputs = currentSectionElement.querySelectorAll('input[required]:not(.question-hidden input), select[required]:not(.question-hidden select)');

                for (let input of visibleRequiredInputs) {
                    // Skip inputs in hidden questions
                    if (input.closest('.question-hidden')) {
                        continue;
                    }

                    if (input.type === 'radio') {
                        const radioGroup = currentSectionElement.querySelectorAll(`input[name="${input.name}"]:not(.question-hidden input)`);
                        const isChecked = Array.from(radioGroup).some(radio => radio.checked);
                        if (!isChecked) {
                            input.focus();
                            alert('Please fill in all required fields before continuing.');
                            return false;
                        }
                    } else if (input.type === 'file') {
                        if (!input.files || input.files.length === 0) {
                            input.focus();
                            alert('Please upload the required file before continuing.');
                            return false;
                        }
                    } else if (!input.value.trim()) {
                        input.focus();
                        alert('Please fill in all required fields before continuing.');
                        return false;
                    } else if (input.type === 'tel') {
                        // Phone number validation - must be 10 digits
                        const phoneValue = input.value.replace(/\D/g, ''); // Remove non-digits
                        if (phoneValue.length !== 10) {
                            input.focus();
                            alert('Please enter a valid 10-digit phone number.');
                            return false;
                        }
                    }
                }

                return true;
            }

            function submitForm() {
                if (!validateCurrentSection()) {
                    return;
                }

                // Get state from address field in Verification section
                const stateInput = document.querySelector('input[name*="State"], select[name*="state"], input[name*="state"]') ||
                                  Array.from(document.querySelectorAll('input, select')).find(input =>
                                      input.closest('.question-container')?.textContent?.includes('State'));
                const selectedState = stateInput?.value;
                if (!selectedState) {
                    alert('Please select your state in the address section before submitting.');
                    return;
                }

                let finalConsultType = 'async';

                // Override to sync if state requires it
                if (syncOnlyStates.includes(selectedState)) {
                    finalConsultType = 'sync';
                }

                // Collect all form data
                const formElement = document.getElementById('medicalForm');
                const formDataObj = new FormData(formElement);
                const webhookData = buildWebhookData(formDataObj, selectedState, finalConsultType);

                // Submit to webhook
                submitToWebhook(webhookData, selectedState, finalConsultType);
            }

            function buildWebhookData(formData, state, consultType) {
                // Find actual question IDs from the form
                const nameInput = document.querySelector('input[type="text"]');
                const emailInput = document.querySelector('input[type="email"]');
                const phoneInput = document.querySelector('input[type="tel"]');
                const heightFeetInput = document.querySelector('input[placeholder*="feet"], input[placeholder*="Feet"]');
                const heightInchesInput = document.querySelector('input[placeholder*="inches"], input[placeholder*="Inches"]');
                const weightInput = document.querySelector('input[placeholder*="weight"], input[placeholder*="Weight"], input[placeholder*="pounds"], input[placeholder*="Pounds"]');

                // Get address fields
                const addressInputs = document.querySelectorAll('input[type="text"]');
                let address = '', address2 = '', city = '', postalCode = '';

                addressInputs.forEach(input => {
                    const label = input.closest('.question-wrapper')?.querySelector('label')?.textContent?.toLowerCase() || '';
                    if (label.includes('address') && !label.includes('2')) {
                        address = input.value || '';
                    } else if (label.includes('address 2')) {
                        address2 = input.value || '';
                    } else if (label.includes('city')) {
                        city = input.value || '';
                    } else if (label.includes('postal') || label.includes('zip')) {
                        postalCode = input.value || '';
                    }
                });

                // Get actual form values
                const name = nameInput?.value || '';
                const email = emailInput?.value || '';
                const phone = phoneInput?.value || '';
                const heightFeet = heightFeetInput?.value || '0';
                const heightInches = heightInchesInput?.value || '0';
                const weight = weightInput?.value || '';
                const bmi = document.getElementById('bmi-value')?.textContent || '';

                // Build comprehensive form answers object with question text as keys
                const formAnswers = {};
                const contactFields = ['name', 'email', 'phone', 'address', 'city', 'state', 'postal'];

                const allInputs = document.querySelectorAll('input, select, textarea');
                allInputs.forEach(input => {
                    // Get question text
                    const questionWrapper = input.closest('.question-wrapper');
                    let questionText = questionWrapper?.querySelector('label')?.textContent?.trim() || input.name;

                    // Remove asterisk from required fields
                    questionText = questionText.replace('*', '').trim();

                    // Escape apostrophes for JavaScript object keys
                    const escapedQuestionText = questionText.replace(/'/g, "\'");

                    // Skip contact info fields - they're already in contact section
                    const isContactField = contactFields.some(field =>
                        questionText.toLowerCase().includes(field) ||
                        (field === 'name' && questionText.toLowerCase().includes('full name'))
                    );

                    if (!isContactField) {
                        if (input.type === 'file') {
                            // Handle file uploads
                            const fileData = formData[input.name];
                            if (fileData && typeof fileData === 'object' && fileData.filename) {
                                formAnswers[escapedQuestionText] = fileData; // Include full file object
                            }
                        } else if (input.name && input.value) {
                            if (input.type === 'radio' || input.type === 'checkbox') {
                                if (input.checked) {
                                    if (formAnswers[escapedQuestionText]) {
                                        // Multiple selections (checkboxes)
                                        if (Array.isArray(formAnswers[escapedQuestionText])) {
                                            formAnswers[escapedQuestionText].push(input.value);
                                        } else {
                                            formAnswers[escapedQuestionText] = [formAnswers[escapedQuestionText], input.value];
                                        }
                                    } else {
                                        formAnswers[escapedQuestionText] = input.value;
                                    }
                                }
                            } else {
                                formAnswers[escapedQuestionText] = input.value;
                            }
                        }
                    }
                });

                // Extract specific data from formAnswers for patient section
                const genderValue = document.querySelector('input[name*="Gender"]:checked')?.value ||
                                  document.querySelector('input[type="radio"]:checked')?.closest('.question-wrapper')?.querySelector('label')?.textContent?.toLowerCase().includes('gender') ?
                                  document.querySelector('input[type="radio"]:checked')?.value : '';

                const dobValue = document.querySelector('input[type="date"]')?.value || '';

                const pregnancyValue = formAnswers['Are you currently pregnant or breastfeeding?'] || '';
                const allergiesValue = formAnswers['Do you have any allergies?'] || '';
                const activityLevelValue = formAnswers['What is your exercise level?'] || '';
                const tobaccoUseValue = formAnswers['Do you currently use tobacco or vape?'] || '';
                const mentalHealthValue = formAnswers['Are you currently experiencing depression with history of suicidal ideation?'] || '';
                const idVerificationValue = formAnswers['Upload government ID (driver\'s license) for identity verification'] || '';

                // Filter out mapped fields from responses
                const mappedFields = [
                    'Are you currently pregnant or breastfeeding?',
                    'Do you have any allergies?',
                    'What is your exercise level?',
                    'Do you currently use tobacco or vape?',
                    'Are you currently experiencing depression with history of suicidal ideation?',
                    'Upload government ID (driver\'s license) for identity verification'
                ];

                const responses = {};
                Object.keys(formAnswers).forEach(key => {
                    if (!mappedFields.includes(key)) {
                        responses[key] = formAnswers[key];
                    }
                });

                // Build the complete webhook data structure
                const data = {
                    contact: {
                        name: name,
                        email: email,
                        gender: genderValue,
                        dateOfBirth: dobValue,
                        phone: phone,
                        address1: address,
                        city: city,
                        state: state,
                        postalCode: postalCode,
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        type: 'patient'
                    },
                    patient: {
                        rxRequested: 'NAD',
                        height: `${heightFeet}'${heightInches}"`,
                        weight: weight,
                        BMI: bmi.replace('BMI: ', '').replace('Enter height and weight above', ''),
                        pregnancy: pregnancyValue,
                        allergies: allergiesValue,
                        activityLevel: activityLevelValue,
                        tobaccoUse: tobaccoUseValue,
                        mentalHealth: mentalHealthValue,
                        idVerification: idVerificationValue
                    },
                    form: {
                        formType: 'screener',
                        category: 'antiaging',
                        name: 'NAD',
                        responses: responses,
                        timestamp: new Date().toISOString(),
                        formVersion: new Date().toISOString().split('T')[0] // Current date as version
                    },
                    clinic: {
                        name: '{{location.name}}',
                        id: '{{location.id}}',
                        email: '{{location.email}}',
                        phone: '{{location.phone}}',
                        integration: '{{custom_values.private}}',
                        type: 'healthcare'
                    }
                };

                return data;
            }


            async function submitToWebhook(data, state, consultType) {
                try {
                    const response = await fetch('https://locumtele.app.n8n.cloud/webhook/patient-screener', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        // Redirect to appropriate fee page
                        const rootDomain = window.location.origin;
                        const redirectUrl = `${rootDomain}/antiaging-${consultType}-fee`;
                        window.location.href = redirectUrl;
                    } else {
                        throw new Error('Submission failed');
                    }
                } catch (error) {
                    console.error('Error submitting form:', error);
                    alert('There was an error submitting your form. Please try again.');
                }
            }
        </script>
</body>
</html>
        